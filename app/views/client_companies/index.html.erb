<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="fw-bold text-primary">Manage Clients</h1>

    <% if current_user.has_permission?("update:client_companies") %>
      <%= link_to "New Client", new_client_path, class: "btn btn-primary" %>
    <% end %>
  </div>

  <% if @client_companies.any? %>
    <div class="card shadow-sm">
      <div class="card-body p-0">
        <table class="table table-striped table-hover mb-0">
          <thead class="table-dark">
            <tr>
              <th class="ps-3">Name</th>
              <th>Status</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @client_companies.each do |client_company| %>
              <tr>
                <% if current_user.has_permission?("update:client_companies") %>
                  <!-- UPDATE FORM -->
                  <%= form_with(model: client_company, url: client_path(client_company), method: :patch, local: true) do |f| %>
                    <td class="ps-3">
                      <%= f.text_field :name, class: "form-control form-control-sm", value: client_company.name %>
                    </td>
                    <td>
                      <%= f.select :status, options_for_select(["Pending", "Active", "Inactive"], selected: client_company.status), {}, class: "form-select form-select-sm" %>
                    </td>
                    <td class="text-center">
                      <div class="d-flex justify-content-center gap-2">
                        <%= f.submit "Update", class: "btn btn-success btn-sm" %>
                      </div>
                    </td>
                  <% end %>

                  <!-- DELETE FORM (outside update form) -->
                  <td class="text-center">
                    <%= form_with model: client_company, url: client_path(client_company), method: :delete, local: true, class: "d-inline" do %>
                      <%= submit_tag "Delete", class: "btn btn-danger btn-sm", data: { confirm: "Are you sure?" } %>
                    <% end %>
                  </td>
                <% else %>
                  <td class="ps-3"><%= client_company.name %></td>
                  <td><%= client_company.status %></td>
                  <td class="text-center">No access</td>
                <% end %>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% else %>
    <div class="alert alert-info mt-3">No clients available.</div>
  <% end %>

  <div class="mt-4">
    <%= link_to "Back to Dashboard", dashboard_path, class: "btn btn-secondary" %>
  </div>
</div>
